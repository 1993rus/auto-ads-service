# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Auto-Ads-Service Backend

## –û–±–∑–æ—Ä

–ù–∞–±–æ—Ä –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ backend —Å–∏—Å—Ç–µ–º—ã auto-ads-service.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### 1. –¢–µ—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–π –ë–î (`1-test-migrations.js`)
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
- –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü Cars –∏ ScrapingLogs
- –°—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–ª–µ–π —Ç–∞–±–ª–∏—Ü
- –ù–∞–ª–∏—á–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

### 2. –¢–µ—Å—Ç Car Service (`2-test-car-service.js`)
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π (upsertCar)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (detectChanges)
- –ú–∞—Å—Å–æ–≤—ã–π upsert (bulkUpsert)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- –ü–∞–≥–∏–Ω–∞—Ü–∏—é
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ ID
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### 3. –¢–µ—Å—Ç Scraper Service (`3-test-scraper-service.js`)
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ú–µ—Ç–æ–¥—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ (extractBrand, extractModel, extractPrice –∏ –¥—Ä.)
- –û–±—Ä–∞–±–æ—Ç–∫—É mock HTML –¥–∞–Ω–Ω—ã—Ö
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é URL –¥–ª—è –ø–æ–∏—Å–∫–∞
- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 4. –¢–µ—Å—Ç API Endpoints (`4-test-api-endpoints.js`)
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (JWT)
- GET /api/cars —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- GET /api/cars/stats
- GET /api/cars/:id
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (404)

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env` —Ñ–∞–π–ª–µ
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```bash
   npx sequelize-cli db:migrate
   ```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (–∫—Ä–æ–º–µ API)

```bash
node tests/run-all-tests.js
```

### –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –¢–µ—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–π
node tests/1-test-migrations.js

# –¢–µ—Å—Ç Car Service
node tests/2-test-car-service.js

# –¢–µ—Å—Ç Scraper Service
node tests/3-test-scraper-service.js
```

### –ó–∞–ø—É—Å–∫ API —Ç–µ—Å—Ç–æ–≤

**–í–ê–ñ–ù–û:** API —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞!

–í –ø–µ—Ä–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
```bash
npm run dev
```

–í–æ –≤—Ç–æ—Ä–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
```bash
node tests/4-test-api-endpoints.js
```

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –£—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```
‚úì –ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: 25
‚úó –ü—Ä–æ–≤–∞–ª–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: 0
üìà –£–°–ü–ï–®–ù–û–°–¢–¨ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø: 100.0%
```

### –ß–∞—Å—Ç–∏—á–Ω—ã–π —É—Å–ø–µ—Ö
```
‚úì –ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: 20
‚úó –ü—Ä–æ–≤–∞–ª–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: 5
üìà –£–°–ü–ï–®–ù–û–°–¢–¨ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø: 80.0%
```

## –ß–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```
‚úó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î: Connection refused
```
**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL –≤ .env
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 5432 –Ω–µ –∑–∞–Ω—è—Ç

### –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
```
‚úó –¢–∞–±–ª–∏—Ü–∞ Cars –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢
```
**–†–µ—à–µ–Ω–∏–µ:**
```bash
npx sequelize-cli db:migrate
```

### API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω (—Ç–µ—Å—Ç 4)
```
‚úó –°–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω: connect ECONNREFUSED
```
**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `npm run dev`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 5001 —Å–≤–æ–±–æ–¥–µ–Ω

### –¢–µ—Å—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
```
‚ö† –ü—Ä–æ–ø—É—â–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (–Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞)
```
**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ Users —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ middleware verifyAccessToken
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ JWT —Å–µ–∫—Ä–µ—Ç—ã –≤ .env

## –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏:

1. **Toyota Camry 2020**
   - –¶–µ–Ω–∞: 2,500,000 ¬•
   - –ü—Ä–æ–±–µ–≥: 30,000 –∫–º
   - External ID: TEST_TOYOTA_CAMRY_001

2. **BMW X5 2021**
   - –¶–µ–Ω–∞: 5,500,000 ¬•
   - –ü—Ä–æ–±–µ–≥: 15,000 –∫–º
   - External ID: TEST_BMW_X5_002

3. **Honda Civic 2019**
   - –¶–µ–Ω–∞: 1,800,000 ¬•
   - –ü—Ä–æ–±–µ–≥: 45,000 –∫–º
   - External ID: TEST_HONDA_CIVIC_003

–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤.

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `5-test-your-feature.js`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
   ```javascript
   async function testYourFeature() {
     const results = { passed: [], failed: [] };

     // –í–∞—à–∏ —Ç–µ—Å—Ç—ã...

     return results;
   }

   module.exports = testYourFeature;
   ```

3. –î–æ–±–∞–≤—å—Ç–µ –≤ `run-all-tests.js`:
   ```javascript
   const testYourFeature = require('./5-test-your-feature');
   // ...
   allResults.yourFeature = await testYourFeature();
   ```

## Mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è Scraper

–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç mock HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å carsensor.net
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ `scraper.service.js`
3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º HTML

–ü—Ä–∏–º–µ—Ä:
```javascript
const fs = require('fs');
const html = fs.readFileSync('real-page.html', 'utf-8');
const cars = await scraperService.scrapeSearchPage(html);
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–¢–∏–ø–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- –¢–µ—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–π: ~2-3 —Å–µ–∫—É–Ω–¥—ã
- –¢–µ—Å—Ç Car Service: ~5-10 —Å–µ–∫—É–Ω–¥
- –¢–µ—Å—Ç Scraper Service: ~1-2 —Å–µ–∫—É–Ω–¥—ã
- –¢–µ—Å—Ç API: ~3-5 —Å–µ–∫—É–Ω–¥

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** ~15-20 —Å–µ–∫—É–Ω–¥

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Jest –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. –î–æ–±–∞–≤—å—Ç–µ coverage —Ä–µ–ø–æ—Ä—Ç—ã
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å CI/CD
4. –î–æ–±–∞–≤—å—Ç–µ E2E —Ç–µ—Å—Ç—ã
5. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è scraper.worker.js
